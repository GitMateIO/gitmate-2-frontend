<div class="flex-bar" style="padding-top:0.5em;">
  <div class="flex-expander"></div>
  <div style="line-height:1.5;font-weight:300;font-size:22px;padding-right:24px;">
    Report for the repository:
  </div>
  <md-input-container style="width:400px;" >
    <input mdInput placeholder="Repository url" [(ngModel)]="repo_url" (keydown)="reportKeyDown($event)">
  </md-input-container>
  <button md-button (click)="get_report()">
    Reload
  </button>
  <div class="flex-expander"></div>
</div>

<div *ngIf="response">
  <md-card class="topic" *ngIf="response.state!=='done'">
    <md-card-title>Your report is in progress</md-card-title>
    <span *ngIf="response.state === 'new'">This is the first time we are creating a report for {{name}}. This will take a while...</span>
    <span *ngIf="response.state === 'scraping'">We are currently scraping your issues from {{provider}}.</span>
    <span *ngIf="response.state === 'scrapefail'"><font color="red">There has been an error while scraping your data! restarting...</font></span>
    <span *ngIf="response.state === 'calc'">We are analysing your repository and calculating the report.</span>
    <span *ngIf="response.state === 'calcfail'"><font color="red">There has been an error while calculating your report! retrying...</font></span>
    <span *ngIf="response.state === 'error'"><font color="red">This repository doesn't exist or isn't publicly accessible</font></span>
    <span *ngIf="response.state === 'reqerror'"><font color="red">Can't connect to the server or another unknown error - we're on it :/</font></span>
    <md-progress-bar mode="indeterminate" *ngIf="response.state !== 'error'"></md-progress-bar>
    <md-progress-bar mode="determinate" value=0 *ngIf="response.state === 'error'"></md-progress-bar>
  </md-card>

</div>


<div *ngIf="status === 'done' && response.state ==='done'">
  <md-card class="topic">
    <md-card-title style="display:flex;align-items:baseline;" >
      <p>GitMate would have saved you</p>
      <p class="value">{{(response.label_prediction_total_set + response.duplicate_total + response.author_prediction_correct_pings)*5/60 | number:'.0-0'}}</p>
      <p>hours of work on your project</p>
    </md-card-title>
    <md-card-subtitle>
      <p>
        Based on {{response.label_prediction_total_set + response.duplicate_total + response.author_prediction_correct_pings}} actions GitMate would have taken for you, valued a 5 minutes each.
      </p>
      <p>
        This analysis did not take issue comments into account, leading to inferior results compared with an active GitMate instance.
      </p>
    </md-card-subtitle>
  </md-card>


  <md-card class="topic" *ngIf="response.label_prediction_total_set > 0">
    <div style="display:flex;align-items:flex-end;">
      <p>GitMate would have set</p>
      <p class="value">{{response.label_prediction_total_set}}</p>
      <p>labels for you</p>
    </div>
    <button md-button (click)="show_labels = !show_labels">show examples</button>

    <div *ngIf="show_labels">
      <md-grid-list cols="3" rowHeight="64px">

        <div *ngFor="let example of response.label_examples">

          <md-grid-tile [colspan]=2>
            <md-nav-list style="width:100%">
              <md-list-item>
                {{example.number}}:&nbsp;
                <a href="https://{{provider}}.com/{{name}}/issues/{{example.number}}">{{example.title}}</a>
              </md-list-item>
            </md-nav-list>
          </md-grid-tile>

          <md-grid-tile>
            <md-chip-list>
              <md-chip *ngFor="let label of example.gitmate">{{label}}</md-chip>
            </md-chip-list>
          </md-grid-tile>

        </div>
      </md-grid-list>
    </div>
  </md-card>

  <md-card class="topic" *ngIf="response.duplicate_total > 0">
    <div style="display:flex;align-items:flex-end;">
      <p>GitMate found</p>
      <p class="value">{{response.duplicate_total}}</p>
      <p>groups of duplicates in your repository</p>
    </div>

    <button md-button (click)="show_dupes = !show_dupes">show examples</button>

    <div *ngIf="show_dupes">
      <md-nav-list>
        <div *ngFor="let example of response.duplicate_examples">

          <md-list-item>
            {{example.number}}:&nbsp;
            <a href="https://{{provider}}.com/{{name}}/issues/{{example.number}}" style="margin-left: 24px;">{{example.title}}</a>
          </md-list-item>

          <md-list-item *ngFor="let x of example.duplicates" >
            {{x.number}}:&nbsp;
            <a href="https://{{provider}}.com/{{name}}/issues/{{x.number}}" style="margin-left: 24px;">{{x.title}}</a>
            <p style="color: #757575">&nbsp;({{x.similarity*100 | number:'1.0-2'}}% similarity)</p>
          </md-list-item>
          <md-divider></md-divider>
        </div>
      </md-nav-list>
    </div>
  </md-card>


  <md-card class="topic" *ngIf="response.author_prediction_correct_pings > 0">
    <div style="display:flex;align-items:flex-end;">
      <p>GitMate would have pinged</p>
      <p class="value">{{response.author_prediction_correct_pings}}</p>
      <p>developers in discussions they later contributed to</p>
    </div>
    <div><font color=red style="font-size:small">The contributor prediction heavily relies on comment data that we didn't scrape for this report</font>
    </div>

    <button md-button (click)="show_authors = !show_authors">show examples</button>

    <div *ngIf="show_authors">
      <md-grid-list cols="3" rowHeight="64px">

        <div *ngFor="let example of response.author_prediction_examples">

          <md-grid-tile [colspan]=2>
            <md-nav-list style="width:100%">
              <md-list-item>
                {{example.number}}:&nbsp;
                <a href="https://{{provider}}.com/{{name}}/issues/{{example.number}}">{{example.title}}</a>
              </md-list-item>
            </md-nav-list>
          </md-grid-tile>

          <md-grid-tile>
            <md-chip-list>
              <md-chip *ngFor="let author of example.gitmate">{{author}}</md-chip>
            </md-chip-list>
          </md-grid-tile>

        </div>
      </md-grid-list>
    </div>
  </md-card>
</div>

<md-card style="text-align:center" *ngIf="!user">
  <span>
    Start saving time and keep your issue tracker clean!
  </span>
  <div style="text-align: center">
    <div class="container center-block buttons">
      <div>
        <button class="big-button" md-raised-button color="accent" (click)="loginGitHub()">
          <md-icon class="vendor-icon" fontSet="fa" fontIcon="fa-github" ></md-icon>
          Use with GitHub
        </button>
      </div>
      <div>
        <button class="big-button" md-raised-button color="accent" (click)="loginGitLab()">
          <md-icon class="vendor-icon" fontSet="fa" fontIcon="fa-gitlab" ></md-icon>
          Use with GitLab
        </button>
      </div>
    </div>
  </div>
</md-card>
